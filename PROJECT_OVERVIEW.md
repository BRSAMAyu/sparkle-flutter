# Sparkle项目总体框架与模块关系

## 项目概述

Sparkle（星火）是一个AI驱动的学习助手应用，专为大学生设计。项目采用前后端分离架构，后端使用FastAPI框架，前端使用Flutter框架。整体架构围绕"AI时间导师"概念，引导用户完成学习循环：对话→任务卡片→执行→反馈→冲刺计划。

## 技术架构

### 后端架构 (FastAPI)
- **核心框架**: FastAPI (Python 3.11+)
- **数据库**: PostgreSQL (生产) / SQLite (开发) 通过SQLAlchemy 2.0 (异步)
- **AI服务**: OpenAI兼容API (支持Qwen/DeepSeek)
- **向量数据库**: pgvector
- **缓存/队列**: Redis
- **异步处理**: APScheduler, 后台任务

### 前端架构 (Flutter)
- **框架**: Flutter 3.x (Dart)
- **状态管理**: flutter_riverpod
- **路由管理**: go_router
- **网络请求**: http, Dio + Retrofit
- **本地存储**: shared_preferences, hive

## 核心模块功能与关系

### 1. 用户管理模块 (User Service)
**功能**: 处理用户认证、注册、个人信息管理
- **后端**: UserService (基础实现)
- **前端**: AuthScreen, ProfileScreen
- **关系**: 为其他所有模块提供用户上下文

### 2. 知识星图模块 (Galaxy Service)
**功能**: 知识点管理、学习进度跟踪、语义搜索
- **后端**: GalaxyService, ExpansionService, DecayService
- **前端**: GalaxyScreen, 星图可视化组件
- **关系**: 与用户模块关联，使用AI模块生成内容，触发推送模块

### 3. 任务管理模块 (Task Service)
**功能**: 任务创建、执行、状态管理
- **后端**: TaskService (完整实现)
- **前端**: TaskListScreen, TaskDetailScreen, TaskExecutionScreen
- **关系**: 与用户、知识星图模块关联，可触发AI对话

### 4. 计划管理模块 (Plan Service)
**功能**: 冲刺计划、成长计划管理
- **后端**: PlanService (API定义完整，但实现有限)
- **前端**: SprintScreen, GrowthScreen (前端实现完整)
- **关系**: 与任务、用户模块关联，触发推送模块

### 5. AI对话模块 (LLM Service)
**功能**: 智能对话、工具调用、内容生成
- **后端**: LLMService, ToolExecutor, Orchestration
- **前端**: ChatScreen
- **关系**: 与所有模块交互，提供智能服务

### 6. 智能推送模块 (Push Service)
**功能**: 基于策略的个性化推送
- **后端**: PushService, 多种推送策略
- **前端**: 通知中心
- **关系**: 与用户、知识星图、计划模块关联

## 模块间关系图

```
         +----------------+
         |   用户模块     |
         |  (User)       |
         +-------+--------+
                 |
    +------------+------------+
    |            |            |
+---v---+   +----v----+   +---v---+
| 知识  |   |  任务   |   | 计划  |
| 星图  |   |  模块   |   | 模块  |
|(Galaxy)|   |(Task)   |   |(Plan) |
+---+---+   +----+----+   +---+---+
    |            |            |
    +------------+------------+
                 |
         +-------v-------+
         |   AI对话模块   |
         |   (LLM)      |
         +-------+-------+
                 |
         +-------v-------+
         |  智能推送模块  |
         |  (Push)      |
         +---------------+
```

## 数据流向

1. **用户认证流**: 用户模块 → 认证 → 其他所有模块
2. **学习流**: 知识星图 → 任务 → 执行 → 反馈 → 计划
3. **AI交互流**: 用户输入 → LLM模块 → 工具执行 → 结果返回
4. **推送流**: 各模块状态 → 推送策略 → 用户通知

## 关键业务流程

### 学习循环流程
1. 用户通过AI对话获取学习建议
2. 系统生成相关任务卡片
3. 用户执行任务并更新进度
4. 知识星图状态更新
5. 系统提供反馈和新计划

### 智能推送流程
1. 定时检查用户状态
2. 评估多种推送策略
3. 生成个性化推送内容
4. 发送通知到前端

## 项目状态总结

- **已完成**: 用户、知识星图、任务、AI对话、推送模块
- **部分完成**: 计划模块(前端完整，后端实现有限)
- **核心亮点**: 知识星图可视化、AI驱动的学习助手、智能推送系统

## 开发要点

### 后端关键实现
- 异步数据库操作
- JWT认证机制
- SSE实时推送
- 向量搜索功能
- 工具调用系统

### 前端关键实现
- 星图可视化(Shader动画)
- 状态管理(Riverpod)
- 实时聊天界面
- 响应式UI设计

## 扩展性设计

项目采用模块化设计，各模块间通过API接口交互，便于功能扩展和维护。
